<?xml version="1.0" encoding="UTF-8"?>

<!--
    Created on : 10 January 2010, 10:12
    Description: WList definition for Request Categories.
-->

<list state="whelpdesk.models.requestcategory.list">
    <!-- Query -->
    <query>
        <select>#__whelpdesk_requests.*</select>
        <select>#__users.name AS name_of_user</select>
        <select>assignee.name AS name_of_assignee</select>
        <select>#__whelpdesk_request_priorities.name AS name_of_priority</select>
        <select>#__whelpdesk_request_priorities.ordering AS priority_ordering</select>
        <select>#__whelpdesk_request_priorities.colour AS priority_colour</select>
        <select>COUNT(#__whelpdesk_request_replies.id) AS number_of_replies</select>
        <select>MAX(#__whelpdesk_request_replies.created) AS last_reply_created</select>
        <from>#__whelpdesk_requests</from>
        <join type="LEFT">#__users ON #__users.id = #__whelpdesk_requests.created_by</join>
        <join type="LEFT">#__users AS assignee ON #__users.id = #__whelpdesk_requests.assignee</join>
        <join type="LEFT">#__whelpdesk_request_priorities ON #__whelpdesk_requests.priority = #__whelpdesk_request_priorities.id</join>
        <join type="LEFT">#__whelpdesk_request_replies ON #__whelpdesk_requests.id = #__whelpdesk_request_replies.request_id</join>
        <order>#__whelpdesk_requests.name</order>
        <group>#__whelpdesk_requests.id</group>
    </query>

    <!-- Filters -->
    <filter
            id="search"
            name="search"
            type="search"
            position="left">
        <label>WHD_LIST:FILTER</label>
        <column>name</column>
        <attribute name="class=">text_area</attribute>
        <attribute name="size">60</attribute>
    </filter>
    <filter
            id="status"
            name="status"
            type="sqlselect"
            position="right"
            key="key"
            text="name">
        <label>WHD_LIST:FILTER</label>
        <column>status</column>
        <attribute name="class=">text_area</attribute>
        <attribute name="size">30</attribute>
        <option key="" translate="true">WHD_R:STATUS:SELECT STATUS</option>
        <option key="1" translate="true">WHD_R:STATUS:OPEN</option>
        <option key="2" translate="true">WHD_R:STATUS:CLOSED</option>
        <option key="3" translate="true">WHD_R:STATUS:REOPENED</option>
        <option key="4" translate="true">WHD_R:STATUS:ARCHIVED</option>
    </filter>
    <filter
            id="priority"
            name="priority"
            type="sqlselect"
            position="right"
            key="id"
            text="name">
        <label>WHD_LIST:FILTER</label>
        <column>#__whelpdesk_requests.priority</column>
        <query>
            <select>DISTINCT #__whelpdesk_request_priorities.name</select>
            <select>#__whelpdesk_request_priorities.id</select>
            <from>#__whelpdesk_request_priorities</from>
            <order>#__whelpdesk_request_priorities.ordering</order>
        </query>
        <attribute name="class=">text_area</attribute>
        <attribute name="size">30</attribute>
        <option key="" translate="true">SELECT PRIORITY</option>
    </filter>
    <filter
            id="category_id"
            name="category_id"
            type="sqlselect"
            position="right"
            key="category_id"
            text="name">
        <label>WHD_LIST:FILTER</label>
        <column>category_id</column>
        <query>
            <select>CONCAT(#__whelpdesk_request_categories.name, " (", #__whelpdesk_request_categories.id, ")") AS name</select>
            <select>#__whelpdesk_request_categories.id AS category_id</select>
            <from>#__whelpdesk_request_categories</from>
            <order>#__whelpdesk_request_categories.lft</order>
            <where>#__whelpdesk_request_categories.parent_id != 0</where>
        </query>
        <attribute name="class=">text_area</attribute>
        <attribute name="size">30</attribute>
        <option category_id="" translate="true">SELECT REQUEST CATEGORY</option>
    </filter>
    <filter
            id="created_by"
            name="created_by"
            type="sqlselect"
            position="right"
            key="created_by"
            text="name_of_user">
        <label>WHD_LIST:FILTER</label>
        <column>priority</column>
        <query>
            <select>DISTINCT #__whelpdesk_requests.created_by</select>
            <select>#__users.name AS name_of_user</select>
            <from>#__whelpdesk_requests</from>
            <join type="LEFT">#__users ON #__users.id = #__whelpdesk_requests.created_by</join>
            <order>#__whelpdesk_requests.name</order>
        </query>
        <attribute name="class=">text_area</attribute>
        <attribute name="size">30</attribute>
        <option key="" translate="true">SELECT SUBMITTED BY</option>
    </filter>
    <filter
            id="assignee"
            name="assignee"
            type="sqlselect"
            position="right"
            key="assignee"
            text="name_of_user">
        <label>WHD_LIST:FILTER</label>
        <column>priority</column>
        <query>
            <select>DISTINCT #__whelpdesk_requests.assignee</select>
            <select>#__users.name AS name_of_user</select>
            <from>#__whelpdesk_requests</from>
            <join type="LEFT">#__users ON #__users.id = #__whelpdesk_requests.assignee</join>
            <order>#__whelpdesk_requests.name</order>
        </query>
        <attribute name="class=">text_area</attribute>
        <attribute name="size">30</attribute>
        <option key="" translate="true">SELECT ASSIGNEE</option>
    </filter>

    <!-- Columns -->
    <column
            type="select"
            cansort="true"
            width="2%">
        <label>WHD_RC:SELECT</label>
        <name>id</name>
    </column>
    <column type="simple" cansort="true">
        <label>WHD_R:REQUEST</label>
        <name>name</name>
        <link link="index.php?option=com_whelpdesk&amp;task=request.edit&amp;id=%1$d">
            <param>id</param>
        </link>
    </column>
    <column
            type="simple"
            cansort="true"
            width="120">
        <label>WHD_DATA:CREATED BY</label>
        <name>name_of_user</name>
        <attribute name="style" value="text-align: center;"/>
        <link link="index.php?option=com_users&amp;task=user.edit&amp;id=%1$d">
            <param>created_by</param>
        </link>
    </column>
    <column
            type="datetime"
            cansort="true"
            width="120">
        <label>WHD_DATA:CREATED</label>
        <name>created</name>
        <attribute name="style" value="text-align: center;"/>
    </column>
    <column
            type="simple"
            cansort="true"
            width="120">
        <label>WHD_R:NUMBER OF REPLIES</label>
        <name>number_of_replies</name>
        <attribute name="style" value="text-align: center;"/>
    </column>
    <column
            type="datetime"
            cansort="true"
            width="120">
        <label>WHD_R:DATETIME OF LAST REPLY</label>
        <name>last_reply_created</name>
        <attribute name="style" value="text-align: center;"/>
    </column>
    <column
            type="simple"
            cansort="true"
            width="80">
        <label>WHD_RP:PRIORITY</label>
        <name>name_of_priority</name>
        <attribute name="style" value="text-align: center;"/>
        <link link="index.php?option=com_whelpdesk&amp;task=requestpriority.edit&amp;id=%1$d">
            <param>priority</param>
            <attribute name="style" value="text-align: center; color: %1$s;">
                <param>priority_colour</param>
            </attribute>
        </link>
    </column>
    <column
            type="enum"
            cansort="true"
            width="120"
            class="helper.RequestStatus">
        <label>WHD_R:STATUS</label>
        <name>status</name>
        <attribute name="style" value="text-align: center;"/>
    </column>
    <column
            type="simple"
            cansort="true"
            width="120">
        <label>WHD_R:ASSIGNEE</label>
        <name>name_of_assignee</name>
        <attribute name="style" value="text-align: center;" />
        <link link="index.php?option=com_users&amp;task=user.edit&amp;id=%1$d">
            <param>created_by</param>
        </link>
    </column>
    <column
            type="simple"
            cansort="true"
            width="70">
        <label>WHD_DATA:REVISION</label>
        <name>revised</name>
        <attribute name="style" value="text-align: center;" />
    </column>
</list>


